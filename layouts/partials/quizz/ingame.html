<section id="quizz-ingame">
  <section class="relative">
    <div class="container">
      <h2 id="quizz-progression-text" class="my-8 text-h1">N°1 qsdqsd</h2>
      <div id="quizz-progression-bar"></div>
      <p id="quizz-question-text"></p>
    </div>
  </section>
    <section id="quizz-choices" class="grid grid-cols-4 gap-8">

    </section>
    <section class="grid grid-cols-4 gap-8">
      <button id="quizz-go-next-question-btn">Suivant</button>
    </section>

  <template id="template-choices-item">
    <button class="border-secondary border-2 rounded-2xl p-4">
      <span class="choice-text"></span>
    </button>
  </template>
</section>

<script>
  let questionIndex = 0;
  let questions = [];
  const choicesContainer = document.getElementById("quizz-choices");
  startQuizz();

  async function startQuizz() {
    const response = await fetch('/questions/index.json');
    questions =  (await response.json()).data;

    document.getElementById("quizz-go-next-question-btn").addEventListener("click", nextQuestion);
    loadQuestion(questions[questionIndex]);
  }

  function showResult(){
    document.querySelector("#quizz-ingame").classList.add("hidden");
    document.querySelector("#result").classList.remove("hidden");
  }

  function nextQuestion() {
    if (questions.userAnswer === null) {
      //Dire à l'user qu'il faut choisir
      return;
    }

    if (questionIndex == questions.length-1 ){
      showResult();
      return;
    }
    questionIndex++;
    loadQuestion(questions[questionIndex]);
  }

  function handleAnswerSelected(questionSelected){
    questions[questionIndex].userAnswer = questionSelected.dataset.text;
    console.log(questions);
  }

  function createElChoice(choice) {
    const template = document.getElementById("template-choices-item");
    const clone = template.content.firstElementChild.cloneNode(true);
    clone.dataset.text = choice.text;
    clone.dataset.score = choice.score;
    clone.querySelector(".choice-text").innerText = choice.text;
    clone.addEventListener("click", ()=>{
      handleAnswerSelected(clone);
    });
    choicesContainer.appendChild(clone);
  }

  function clearQuestionAnswers() {
    while (choicesContainer.firstChild) {
      choicesContainer.removeChild(choicesContainer.firstChild);
    }
  }

  function loadQuestion(question) {
    document.getElementById("quizz-question-text").innerText = question.text;
    console.log(question.choices);
    clearQuestionAnswers();
    question.choices.forEach(choice => {
      createElChoice(choice);
    });
  }
</script>
